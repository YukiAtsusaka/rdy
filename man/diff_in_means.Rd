% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/diff_in_means.R
\name{diff_in_means}
\alias{diff_in_means}
\title{Estimate ranking effects: weighted, unit-normalized \link{-1,1}, and standardized}
\usage{
diff_in_means(
  data,
  items,
  treat,
  weights = NULL,
  se_type = "HC2",
  clusters = NULL,
  na_action = c("drop", "none"),
  top_k_max = NULL,
  return_models = FALSE,
  ...
)
}
\arguments{
\item{data}{A data.frame/tibble containing \code{items}, \code{treat}, and optionally \code{weights}.}

\item{items}{Character vector of ranking columns (1 = top/best). Length \(\ge 2\).}

\item{treat}{String; binary treatment column (0/1, logical, or factor that can be mapped to 0/1).}

\item{weights}{NULL, a numeric vector of length \code{nrow(data)}, or a single string naming a weight column.}

\item{se_type}{SE type passed to \code{estimatr::lm_robust} (default "HC2").}

\item{clusters}{Optional string naming a clustering variable in \code{data} (forwarded to \code{lm_robust}).}

\item{na_action}{"drop" (default) to listwise drop on used columns, or "none".}

\item{top_k_max}{Optional integer; cap for top-k block (default \code{length(items)-1}).}

\item{return_models}{Logical; if TRUE, also returns (placeholder) model list. Default FALSE.}

\item{...}{Extra args passed to \code{estimatr::lm_robust}.}
}
\value{
Tibble with rows for all effects across all items. Columns include:
\itemize{
\item \code{estimate_raw, std.error_raw, conf.low_raw, conf.high_raw}
\item \code{estimate_unit, std.error_unit, conf.low_unit, conf.high_unit}  (in \link{-1,1})
\item \code{estimate_std, std.error_std, conf.low_std, conf.high_std}      (standardized by control SD)
\item \code{sd_control_unit} (the control-group SD on the unit scale used to standardize)
\item \code{p.value}, \code{outcome}, \code{effect_type}, \code{item}, \code{J}
\item diagnostics: \code{n, n_treat, n_control, w_sum, w_treat_sum, w_control_sum}
}
If \code{return_models=TRUE}, returns a list with \code{results} and a placeholder \code{models}.
}
\description{
For each item in \code{items}, constructs:
\enumerate{
\item Average rank of the target (1 = best), reversed and scaled to unit range:
\eqn{\Delta_{\text{unit}} = -\Delta_{\text{rank}}/(J-1) \in [-1,1]}.
\item Pairwise wins vs. others (binary).
\item Top-k indicators for the target (k = 1..J-1) (binary).
\item Marginal rank indicators for the target (r = 1..J) (binary).
}
}
\details{
Estimation is difference-in-means via \code{estimatr::lm_robust} (optionally weighted).
For each effect, returns:
\itemize{
\item Raw ATE (\code{*_raw})
\item \strong{Unit-normalized} ATE in \link{-1,1} (\code{*_unit})
\item \strong{Standardized} ATE dividing \code{_unit} by the control SD on the same scale (\code{*_std})
}
}
\examples{
set.seed(1)
n <- 300
}
